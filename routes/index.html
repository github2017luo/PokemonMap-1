<!DOCTYPE html>
<html>

<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            height: 100%;
        }

        #dropdown {
            position: absolute;
            margin: 10px;
            top: -3.5px;
            left: 340px;
            background-color: #fff;
            padding: 0 11px 0 13px;
            border-bottom: 1px solid #9e9e9e;
        }

        .select-wrapper input.select-dropdown {
            margin-bottom: 0px;
            border-bottom: 0px;
        }

        .controls {
            margin-top: 10px;
            border: 1px solid transparent;
            border-radius: 2px 0 0 2px;
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            height: 32px;
            outline: none;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        #pac-input {
            background-color: #fff;
            font-family: Roboto;
            font-size: 15px;
            font-weight: 300;
            margin-left: 12px;
            padding: 0 11px 0 13px;
            text-overflow: ellipsis;
            width: 300px;
            top: 7px!important;
            left: 0px!important;
        }

        #pac-input:focus {
            border-color: #4d90fe;
        }

        .pac-container {
            font-family: Roboto;
        }

        #type-selector {
            color: #fff;
            background-color: #4d90fe;
            padding: 5px 11px 0px 11px;
        }

        #type-selector label {
            font-family: Roboto;
            font-size: 13px;
            font-weight: 300;
        }

        #target {
            width: 345px;
        }
    </style>
</head>

<body>
    <input id="pac-input" class="controls" type="text" placeholder="Search Box">
    <div id="map"></div>
    <div class="input-field col s12" id="dropdown">
        <select onchange="dropDown();" id="selectId">
            <option value="all">All Pokemon</option>
            <option value="bulbasaur">Bulbasaur</option>
            <option value="ivysaur">Ivysaur</option>
            <option value="venusaur">Venusaur</option>
            <option value="charmander">Charmander</option>
            <option value="charmeleon">Charmeleon</option>
            <option value="charizard">Charizard</option>
            <option value="squirtle">Squirtle</option>
            <option value="wartortle">Wartortle</option>
            <option value="blastoise">Blastoise</option>
            <option value="caterpie">Caterpie</option>
            <option value="metapod">Metapod</option>
            <option value="butterfree">Butterfree</option>
            <option value="weedle">Weedle</option>
            <option value="kakuna">Kakuna</option>
            <option value="beedrill">Beedrill</option>
            <option value="pidgey">Pidgey</option>
            <option value="pidgeotto">Pidgeotto</option>
            <option value="pidgeot">Pidgeot</option>
            <option value="rattata">Rattata</option>
            <option value="raticate">Raticate</option>
            <option value="spearow">Spearow</option>
            <option value="fearow">Fearow</option>
            <option value="ekans">Ekans</option>
            <option value="arbok">Arbok</option>
            <option value="pikachu">Pikachu</option>
            <option value="raichu">Raichu</option>
            <option value="sandshrew">Sandshrew</option>
            <option value="sandslash">Sandslash</option>
            <option value="nidoran♀">Nidoran♀</option>
            <option value="nidorina">Nidorina</option>
            <option value="nidoqueen">Nidoqueen</option>
            <option value="nidoran♂">Nidoran♂</option>
            <option value="nidorino">Nidorino</option>
            <option value="nidoking">Nidoking</option>
            <option value="clefairy">Clefairy</option>
            <option value="clefable">Clefable</option>
            <option value="vulpix">Vulpix</option>
            <option value="ninetales">Ninetales</option>
            <option value="jigglypuff">Jigglypuff</option>
            <option value="wigglytuff">Wigglytuff</option>
            <option value="zubat">Zubat</option>
            <option value="golbat">Golbat</option>
            <option value="oddish">Oddish</option>
            <option value="gloom">Gloom</option>
            <option value="vileplume">Vileplume</option>
            <option value="paras">Paras</option>
            <option value="parasect">Parasect</option>
            <option value="venonat">Venonat</option>
            <option value="venomoth">Venomoth</option>
            <option value="diglett">Diglett</option>
            <option value="dugtrio">Dugtrio</option>
            <option value="meowth">Meowth</option>
            <option value="persian">Persian</option>
            <option value="psyduck">Psyduck</option>
            <option value="golduck">Golduck</option>
            <option value="mankey">Mankey</option>
            <option value="primeape">Primeape</option>
            <option value="growlithe">Growlithe</option>
            <option value="arcanine">Arcanine</option>
            <option value="poliwag">Poliwag</option>
            <option value="poliwhirl">Poliwhirl</option>
            <option value="poliwrath">Poliwrath</option>
            <option value="abra">Abra</option>
            <option value="kadabra">Kadabra</option>
            <option value="alakazam">Alakazam</option>
            <option value="machop">Machop</option>
            <option value="machoke">Machoke</option>
            <option value="machamp">Machamp</option>
            <option value="bellsprout">Bellsprout</option>
            <option value="weepinbell">Weepinbell</option>
            <option value="victreebel">Victreebel</option>
            <option value="tentacool">Tentacool</option>
            <option value="tentacruel">Tentacruel</option>
            <option value="geodude">Geodude</option>
            <option value="graveler">Graveler</option>
            <option value="golem">Golem</option>
            <option value="ponyta">Ponyta</option>
            <option value="rapidash">Rapidash</option>
            <option value="slowpoke">Slowpoke</option>
            <option value="slowbro">Slowbro</option>
            <option value="magnemite">Magnemite</option>
            <option value="magneton">Magneton</option>
            <option value="farfetch'd">Farfetch'd</option>
            <option value="doduo">Doduo</option>
            <option value="dodrio">Dodrio</option>
            <option value="seel">Seel</option>
            <option value="dewgong">Dewgong</option>
            <option value="grimer">Grimer</option>
            <option value="muk">Muk</option>
            <option value="shellder">Shellder</option>
            <option value="cloyster">Cloyster</option>
            <option value="gastly">Gastly</option>
            <option value="haunter">Haunter</option>
            <option value="gengar">Gengar</option>
            <option value="onix">Onix</option>
            <option value="drowzee">Drowzee</option>
            <option value="hypno">Hypno</option>
            <option value="krabby">Krabby</option>
            <option value="kingler">Kingler</option>
            <option value="voltorb">Voltorb</option>
            <option value="electrode">Electrode</option>
            <option value="exeggcute">Exeggcute</option>
            <option value="exeggutor">Exeggutor</option>
            <option value="cubone">Cubone</option>
            <option value="marowak">Marowak</option>
            <option value="hitmonlee">Hitmonlee</option>
            <option value="hitmonchan">Hitmonchan</option>
            <option value="lickitung">Lickitung</option>
            <option value="koffing">Koffing</option>
            <option value="weezing">Weezing</option>
            <option value="rhyhorn">Rhyhorn</option>
            <option value="rhydon">Rhydon</option>
            <option value="chansey">Chansey</option>
            <option value="tangela">Tangela</option>
            <option value="kangaskhan">Kangaskhan</option>
            <option value="horsea">Horsea</option>
            <option value="seadra">Seadra</option>
            <option value="goldeen">Goldeen</option>
            <option value="seaking">Seaking</option>
            <option value="staryu">Staryu</option>
            <option value="starmie">Starmie</option>
            <option value="mr. mime">Mr. Mime</option>
            <option value="scyther">Scyther</option>
            <option value="jynx">Jynx</option>
            <option value="electabuzz">Electabuzz</option>
            <option value="magmar">Magmar</option>
            <option value="pinsir">Pinsir</option>
            <option value="tauros">Tauros</option>
            <option value="magikarp">Magikarp</option>
            <option value="gyarados">Gyarados</option>
            <option value="lapras">Lapras</option>
            <option value="ditto">Ditto</option>
            <option value="eevee">Eevee</option>
            <option value="vaporeon">Vaporeon</option>
            <option value="jolteon">Jolteon</option>
            <option value="flareon">Flareon</option>
            <option value="porygon">Porygon</option>
            <option value="omanyte">Omanyte</option>
            <option value="omastar">Omastar</option>
            <option value="kabuto">Kabuto</option>
            <option value="kabutops">Kabutops</option>
            <option value="aerodactyl">Aerodactyl</option>
            <option value="snorlax">Snorlax</option>
            <option value="articuno">Articuno</option>
            <option value="zapdos">Zapdos</option>
            <option value="moltres">Moltres</option>
            <option value="dratini">Dratini</option>
            <option value="dragonair">Dragonair</option>
            <option value="dragonite">Dragonite</option>
            <option value="mewtwo">Mewtwo</option>
            <option value="mew">Mew</option>
        </select>
    </div>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>
    <script>
        $(document).ready(function() {
            $('select').material_select();
        });
    </script>
    <script>
    var markers = [];
    var map;
    var globalLength;
        function initAutocomplete() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {
                    lat: 34.397,
                    lng: -41.644
                },
                zoom: 3,
                mapTypeControlOptions: {
                    mapTypeIds: []
                },
                mapTypeId: 'roadmap'
            });

            var input = document.getElementById('pac-input');
            var searchBox = new google.maps.places.SearchBox(input);
            map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

            map.addListener('bounds_changed', function() {
                searchBox.setBounds(map.getBounds());
            });

            searchBox.addListener('places_changed', function() {
                var places = searchBox.getPlaces();

                if (places.length == 0) {
                    return;
                }
                markers.forEach(function(marker) {
                    marker.setMap(null);
                });
                markers = [];

                var bounds = new google.maps.LatLngBounds();
                places.forEach(function(place) {
                    if (!place.geometry) {
                        console.log("Returned place contains no geometry");
                        return;
                    }
                    var icon = {
                        url: place.icon,
                        size: new google.maps.Size(71, 71),
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(17, 34),
                        scaledSize: new google.maps.Size(25, 25)
                    };

                    markers.push(new google.maps.Marker({
                        map: map,
                        icon: icon,
                        title: place.name,
                        position: place.geometry.location
                    }));


                    if (place.geometry.viewport) {
                        bounds.union(place.geometry.viewport);
                    } else {
                        bounds.extend(place.geometry.location);
                    }
                });
                map.fitBounds(bounds);
            });
            var nothing = "";
            test(nothing);
        }

        function test(optional) {
                      setInvisibleOnAll();
                      var url = '/sightings/' + optional;
                      var request = new XMLHttpRequest();
                      request.open('GET', url, true);

                      request.onload = function() {
                          if (request.status >= 200 && request.status < 400) {
                              var resp = request.responseText;
                          } else {}
                      };

                      var temp = null;
                      request.onerror = function() {};
                      request.send();
                      request.onreadystatechange = function() {
                          if (request.readyState === XMLHttpRequest.DONE && request.status === 200) {
                              temp = JSON.parse(request.responseText);
                              for (var i = 0; i < temp.length; i++) {
                                  if ((JSON.stringify(temp[i].pokedex_id).length) == 1) {
                                    var string = "http://assets.pokemon.com/assets/cms2/img/pokedex/full/00" + temp[i].pokedex_id + ".png";
                                  } else if ((JSON.stringify(temp[i].pokedex_id).length) == 2) {
                                    var string = "http://assets.pokemon.com/assets/cms2/img/pokedex/full/0" + temp[i].pokedex_id + ".png";
                                  } else if ((JSON.stringify(temp[i].pokedex_id).length) == 3) {
                                    var string = "http://assets.pokemon.com/assets/cms2/img/pokedex/full/" + temp[i].pokedex_id + ".png";
                                  }

                                  var icon = {
                                      url: string,
                                      scaledSize: new google.maps.Size(50, 50),
                                      origin: new google.maps.Point(0, 0),
                                      anchor: new google.maps.Point(25, 25)
                                  };
                                  var myLatlng = new google.maps.LatLng(temp[i].location.coordinates[1], temp[i].location.coordinates[0]);
                                  var marker = new google.maps.Marker({
                                      position: myLatlng,
                                      map: map,
                                      animation: google.maps.Animation.DROP,
                                      icon: icon
                                  });
                                  markers.push(marker);
                              }
                          }
                      }
        }

        function dropDown() {
          var select = document.getElementById('selectId');
          var str = select.options[select.selectedIndex].value;
          if (str == "all") {
            str = "";
          }
          var url = "/sightings/" + str;


          var request = new XMLHttpRequest();
          request.open('GET', url, true);

          request.onload = function() {
              if (request.status >= 200 && request.status < 400) {
                  var resp = request.responseText;
              } else {}
          };

          test(str);

/*
          var temp = null;
          request.onerror = function() {};
          request.send();
          request.onreadystatechange = function() {
              if (request.readyState === XMLHttpRequest.DONE && request.status === 200) {
                  temp = JSON.parse(request.responseText);
                  for (var i = 0; i < temp.length; i++) {
                      if ((JSON.stringify(temp[i].pokedex_id).length) == 1) {
                        var string = "http://assets.pokemon.com/assets/cms2/img/pokedex/full/00" + temp[i].pokedex_id + ".png";
                      } else if ((JSON.stringify(temp[i].pokedex_id).length) == 2) {
                        var string = "http://assets.pokemon.com/assets/cms2/img/pokedex/full/0" + temp[i].pokedex_id + ".png";
                      } else if ((JSON.stringify(temp[i].pokedex_id).length) == 3) {
                        var string = "http://assets.pokemon.com/assets/cms2/img/pokedex/full/" + temp[i].pokedex_id + ".png";
                      }
                      console.log(temp[i].location.coordinates[1]);

                      var icon = {
                          url: string,
                          scaledSize: new google.maps.Size(50, 50),
                          origin: new google.maps.Point(0, 0),
                          anchor: new google.maps.Point(25, 25)
                      };
                      var myLatlng = new google.maps.LatLng(temp[i].location.coordinates[1], temp[i].location.coordinates[0]);
                      marker = new google.maps.Marker({
                          position: myLatlng,
                          title: "vaporeon",
                          animation: google.maps.Animation.DROP,
                          icon: icon
                      });
                    markers.push(marker);
                    console.log(markers[2]);
                    markers[3].setVisible(true);
                  }
              }
            }
            */
        }

        function setInvisibleOnAll() {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setVisible(false);
            }
            globalLength = markers.length;
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-IXLlQOUNyFo5WY8PKtNN15wF4H5ZWj8&libraries=places&callback=initAutocomplete" async defer>
    </script>
    <script>

/*
        var request = new XMLHttpRequest();
        request.open('GET', url, true);

        request.onload = function() {
            if (request.status >= 200 && request.status < 400) {
                var resp = request.responseText;
            } else {}
        };

        var temp = null;
        request.onerror = function() {};
        request.send();
        request.onreadystatechange = function() {
            if (request.readyState === XMLHttpRequest.DONE && request.status === 200) {
                temp = JSON.parse(request.responseText);
                for (var i = 0; i < temp.length; i++) {
                    if ((JSON.stringify(temp[i].pokedex_id).length) == 1) {
                      var string = "http://assets.pokemon.com/assets/cms2/img/pokedex/full/00" + temp[i].pokedex_id + ".png";
                    } else if ((JSON.stringify(temp[i].pokedex_id).length) == 2) {
                      var string = "http://assets.pokemon.com/assets/cms2/img/pokedex/full/0" + temp[i].pokedex_id + ".png";
                    } else if ((JSON.stringify(temp[i].pokedex_id).length) == 3) {
                      var string = "http://assets.pokemon.com/assets/cms2/img/pokedex/full/" + temp[i].pokedex_id + ".png";
                    }

                    var icon = {
                        url: string,
                        scaledSize: new google.maps.Size(50, 50),
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(25, 25)
                    };
                    var myLatlng = new google.maps.LatLng(temp[i].location.coordinates[1], temp[i].location.coordinates[0]);
                    marker = new google.maps.Marker({
                        position: myLatlng,
                        title: "vaporeon",
                        animation: google.maps.Animation.DROP,
                        icon: icon
                    });
                }
            }
          } */
    </script>
    <script>

    </script>
</body>

</html>